{% extends "deliverylayout.html" %}
{% block content %}
<div class="container mt-4">
  <h2>ðŸ“¦ My Delivery Stats</h2>
  <div class="row mt-3">

    <div class="col-md-3">
      <div class="card text-white bg-primary mb-3">
        <div class="card-body">
          <h5 class="card-title">Total Deliveries</h5>
          <p class="card-text">{{ total }}</p>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card text-white bg-success mb-3">
        <div class="card-body">
          <h5 class="card-title">Delivered</h5>
          <p class="card-text">{{ delivered }}</p>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card text-white bg-warning mb-3">
        <div class="card-body">
          <h5 class="card-title">In Progress</h5>
          <p class="card-text">{{ in_progress }}</p>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card text-white bg-danger mb-3">
        <div class="card-body">
          <h5 class="card-title">Cancelled</h5>
          <p class="card-text">{{ cancelled }}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-3">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">Success Rate</div>
        <div class="card-body">
          <h4>{{ success_rate }}%</h4>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card">
        <div class="card-header">Average Delivery Time</div>
        <div class="card-body">
          <h4>{{ avg_delivery_time }} minutes</h4>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-4">
    <h4>ðŸ“‹ Recent Deliveries</h4>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Status</th>
          <th>Start</th>
          <th>End</th>
          <th>Time Taken</th>
        </tr>
      </thead>
      <tbody>
        {% for d in recent_deliveries %}
        <tr>
          <td>{{ d.order_id }}</td>
          <td>{{ d.status }}</td>
          <td>{{ d.start_time.strftime('%Y-%m-%d %H:%M') if d.start_time }}</td>
          <td>{{ d.end_time.strftime('%Y-%m-%d %H:%M') if d.end_time }}</td>
          <td>
            {% if d.start_time and d.end_time %}
              {{ ((d.end_time - d.start_time).total_seconds() / 60) | round(1) }} mins
            {% else %}
              N/A
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
